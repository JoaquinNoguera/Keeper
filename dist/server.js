!function(e){var r={};function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)n.d(t,a,function(r){return e[r]}.bind(null,a));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=14)}([function(e,r){e.exports=require("@babel/runtime/regenerator")},function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,r,n){var t=n(5).Schema,a=n(5).model,o=n(4).createHash,s=new t({name:{type:String,required:!0},email:{type:String,required:!0},password:{type:String,required:!0},section:{type:[{color:{type:String,required:!0,default:"AMARILLO"},icon:{type:String,required:!0},title:{type:String,required:!0},description:{type:String,required:!0},cards:{type:[{title:{type:String,required:!0},description:{type:String,required:!0,default:""},color:{type:String,required:!0,default:"AMARILLO"}}],required:!0,default:[]}}],required:!0,default:[]},recoveryCode:String});s.methods.generateHash=function(e){return o("sha256").update(e).digest("hex")},s.methods.validPassword=function(e){return o("sha256").update(e).digest("hex")===this.password},s.methods.generateHashRecoveryCode=function(e){return o("sha256").update(e).digest("hex")},s.methods.validRecoveryCode=function(e){return o("sha256").update(e).digest("hex")===this.recoveryCode},e.exports=a("User",s)},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("@babel/runtime/helpers/objectDestructuringEmpty")},function(e,r){e.exports=require("nodemailer")},function(e,r){e.exports=require("graphql-tools")},function(e,r){e.exports=require("express-graphql")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("cors")},function(e,r,n){"use strict";n.r(r);var t=n(3),a=n.n(t),o=n(6),s=n.n(o),i=a()();i.get("*",(function(e,r){r.sendFile(s.a.join(__dirname+"/views/index.html"))}));var c=i,u=n(8),p=n.n(u),d=n(0),l=n.n(d),f=n(1),h=n.n(f),x=n(2),w=n.n(x);function g(e){for(var r="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=n.length,a=0;a<e;a++)r+=n.charAt(Math.floor(Math.random()*t));return r}var v,m,y,b,S,C,k,q,E,U,I,P,A,O,j,T,_=n(4),H=n(7),M=function(e){var r=e.user,n=e.res,t=Object(H.sign)({userId:r._id},process.env.AUTHENTICATION_SECRET,{expiresIn:"60m"});n.cookie("token",t,{expires:new Date(Date.now()+36e5),secure:!0,httpOnly:!1,sameSite:"lax"})},B=function(){var e=h()(l.a.mark((function e(r){var n,t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.req,t=n.cookies.token||""){e.next=6;break}throw new Error("user is not authenticate");case 6:return a=Object(H.verify)(t,process.env.AUTHENTICATION_SECRET,(function(e,r){if(r)return r;throw new Error("user not authenticate")})),e.next=9,w.a.findById(a.userId);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),N=n(9),R=n.n(N).a.createTransport({service:"gmail",auth:{user:process.env.GMAIL_USER,pass:process.env.GMAIL_PASS}}),L=function(){var e=h()(l.a.mark((function e(r){var n,t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.email,t=r.code,a=r.username,e.prev=1,e.next=4,R.sendMail({from:"Keeper",to:n,subject:"Recuperar Contraseña",html:'\n          <div style="color:#444444; font-size:12px; line-height:20px; padding:16px 16px 16px 16px; text-align:Center;">\n            <h1 style="color:#black; font-size:2.2em; text-align:left;">Hola, '.concat(a,' </h1>\n          <p style="color:#333; font-size:1.3em; text-align:Justify;">\n              Así que no te olvidas de la cabeza porque la tenes pegada. Tranquilo\n              guachin, acá tenemos todo cubierto. Ingresá el siguiente codigo en \n              nuestra pagina para recuperar la cuenta:</p>\n          \n          <h3 style="color:#c47000; letter-spacing: 0.2em; font-size:2em;"> ').concat(t,' </h3>\n          <a href="">\n          <button style=" background-color: #FEE37F;\n                          cursor: pointer;\n                          margin: 0.6em auto;\n                          border: none;\n                          border-radius: 0.4em;\n                          font-size: 1em;\n                          font-weight: 600;\n                          height: 4em;\n                          cursor: pointer;\n                          width: 20em;">Ingresar Codigo</button>\n                          </a>\n        </div>\n          ')});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(r){return e.apply(this,arguments)}}(),z={Query:{currentUser:(T=h()(l.a.mark((function e(r,n,t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B({req:t});case 2:return a=e.sent,e.abrupt("return",{user:a});case 4:case"end":return e.stop()}}),e)}))),function(e,r,n){return T.apply(this,arguments)}),getUserByCode:(j=h()(l.a.mark((function e(r,n){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.code,e.next=3,w.a.findOne({recoveryCode:Object(_.createHash)("sha256").update(t).digest("hex")});case 3:if(a=e.sent){e.next=6;break}throw new Error("El codigo que ha ingresado es invalido");case 6:return e.abrupt("return",{user:a});case 7:case"end":return e.stop()}}),e)}))),function(e,r){return j.apply(this,arguments)}),getCards:(O=h()(l.a.mark((function e(r,n,t){var a,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.section,e.next=3,B({req:t});case 3:if(o=e.sent,-1!==(s=o.section.findIndex((function(e){return e.title.toUpperCase()===a.toUpperCase()})))){e.next=7;break}throw new Error("No existe una sección con ese nombre");case 7:return e.abrupt("return",o.section[s].cards);case 8:case"end":return e.stop()}}),e)}))),function(e,r,n){return O.apply(this,arguments)})},Mutation:{login:(A=h()(l.a.mark((function e(r,n,t){var a,o,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.username,o=n.password,s=t.res,e.next=4,w.a.findOne({$or:[{name:a},{email:a}]});case 4:if(i=e.sent){e.next=7;break}throw new Error("El usuario que ha ingresado es invalido o no existe");case 7:if(i.validPassword(o)){e.next=10;break}throw new Error("El usuario que ha ingresado es invalido o no existe");case 10:return M({user:i,res:s}),e.abrupt("return",{user:i});case 12:case"end":return e.stop()}}),e)}))),function(e,r,n){return A.apply(this,arguments)}),singup:(P=h()(l.a.mark((function e(r,n,t){var a,o,s,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.input,o=t.res,s=a.name,i=a.email,c=a.password,e.next=5,w.a.findOne({$or:[{name:s},{email:i}]});case 5:if(!(u=e.sent)){e.next=11;break}if(i!==u.email){e.next=9;break}throw new Error("Ya existe un usuario registrado con ese email");case 9:if(s!==u.name){e.next=11;break}throw new Error("Ya existe un usuario registrado con ese nombre");case 11:return(p=new w.a(a)).password=p.generateHash(c),p.save(),M({user:user,res:o}),e.abrupt("return",{user:p});case 16:case"end":return e.stop()}}),e)}))),function(e,r,n){return P.apply(this,arguments)}),logout:function(e,r,n){p()(r);var t=n.res;return{res:t}.res.clearCookie("token"),!0},changePassword:(I=h()(l.a.mark((function e(r,n,t){var a,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.oldPassword,o=n.newPassword,e.next=3,B({req:t});case 3:if((s=e.sent).validPassword(a)){e.next=7;break}throw new Error("Su contraseña es incrrecta");case 7:return s.password=s.generateHash(o),e.next=10,w.a.findByIdAndUpdate(s._id,{password:s.password});case 10:if(e.sent){e.next=13;break}throw new Error("Ha ocurrido un error, por favor intentelo mas tarde");case 13:return M({user:s,res:t.res}),e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e)}))),function(e,r,n){return I.apply(this,arguments)}),newAccessToken:(U=h()(l.a.mark((function e(r,n,t){var a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.password,e.next=3,B({req:t});case 3:if(o=e.sent){e.next=6;break}throw new Error("El usuario no esta autentificado");case 6:if(o.validPassword(a)){e.next=8;break}throw new Error("La contraseña es incorrecta");case 8:return M({user:o,res:t.res}),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e)}))),function(e,r,n){return U.apply(this,arguments)}),sendCodEmail:(E=h()(l.a.mark((function e(r,n){var t,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.username,e.next=3,w.a.findOne({$or:[{name:t},{email:t}]});case 3:if(a=e.sent){e.next=6;break}throw new Error("");case 6:return o=g(5),a.recoveryCode=a.generateHashRecoveryCode(o),a.save(),L({email:a.email,code:o,username:a.name}),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e)}))),function(e,r){return E.apply(this,arguments)}),recoveryPassword:(q=h()(l.a.mark((function e(r,n){var t,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.code,a=n.newPassword,e.next=3,w.a.findOne({recoveryCode:Object(_.createHash)("sha256").update(t).digest("hex")});case 3:if(o=e.sent){e.next=6;break}throw new Error("El codigo que ha ingresado es invalido");case 6:return o.password=o.generateHash(a),o.recoveryCode=null,o.save(),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e)}))),function(e,r){return q.apply(this,arguments)}),checkCode:(k=h()(l.a.mark((function e(r,n){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.code,e.next=3,w.a.findOne({recoveryCode:Object(_.createHash)("sha256").update(t).digest("hex")});case 3:if(e.sent){e.next=6;break}throw new Error("El codigo que ha ingresado es invalido");case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)}))),function(e,r){return k.apply(this,arguments)}),createSection:(C=h()(l.a.mark((function e(r,n,t){var a,o,s,i,c,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.input,o=a.color,s=a.icon,i=a.title,c=a.description,e.next=4,B({req:t});case 4:if(!(u=e.sent).section.find((function(e){return e.title.toUpperCase()===i.toUpperCase()}))){e.next=8;break}throw new Error("Ya hay una sección creada con ese nombre");case 8:return u.section.unshift({color:o,icon:s,title:i,description:c}),u.save(),e.abrupt("return",{user:u});case 11:case"end":return e.stop()}}),e)}))),function(e,r,n){return C.apply(this,arguments)}),deleteSection:(S=h()(l.a.mark((function e(r,n,t){var a,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.title,e.next=3,B({req:t});case 3:return o=e.sent,s=o.section.findIndex((function(e){return e.title.toUpperCase()===a.toUpperCase()})),o.section.splice(s,1),o.save(),e.abrupt("return",{user:o});case 8:case"end":return e.stop()}}),e)}))),function(e,r,n){return S.apply(this,arguments)}),editSection:(b=h()(l.a.mark((function e(r,n,t){var a,o,s,i,c,u,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.oldTitle,o=n.input,s=o.color,i=o.icon,c=o.title,u=o.description,e.next=4,B({req:t});case 4:if(p=e.sent,d=p.section.findIndex((function(e){return e.title.toUpperCase()===a.toUpperCase()})),c===a){e.next=10;break}if(-1===p.section.findIndex((function(e){return e.title.toUpperCase()===c.toUpperCase()}))){e.next=10;break}throw new Error("Ya existe una seccion con ese nombre");case 10:return p.section[d].color=s,p.section[d].icon=i,p.section[d].title=c,p.section[d].description=u,p.save(),e.abrupt("return",{user:p});case 16:case"end":return e.stop()}}),e)}))),function(e,r,n){return b.apply(this,arguments)}),createCard:(y=h()(l.a.mark((function e(r,n,t){var a,o,s,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.section,o=n.input,s=o.color,i=o.title,c=o.description,e.next=4,B({req:t});case 4:if(u=e.sent,-1!==(p=u.section.findIndex((function(e){return e.title.toUpperCase()===a.toUpperCase()})))){e.next=8;break}throw new Error("No existe una sección con ese nombre");case 8:if(-1===u.section[p].cards.findIndex((function(e){return e.title.toUpperCase()===i.toUpperCase()}))){e.next=11;break}throw new Error("Ya existe una nota con ese nombre");case 11:return u.section[p].cards.unshift({color:s,title:i,description:c}),u.save(),e.abrupt("return",u.section[p].cards);case 14:case"end":return e.stop()}}),e)}))),function(e,r,n){return y.apply(this,arguments)}),deleteCard:(m=h()(l.a.mark((function e(r,n,t){var a,o,s,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.section,o=n.card,e.next=3,B({req:t});case 3:if(s=e.sent,-1!==(i=s.section.findIndex((function(e){return e.title.toUpperCase()===a.toUpperCase()})))){e.next=7;break}throw new Error("No existe una sección con ese nombre");case 7:if(-1!==(c=s.section[i].cards.findIndex((function(e){return e.title.toUpperCase()===o.toUpperCase()})))){e.next=10;break}throw new Error("No existe una nota con ese nombre");case 10:return s.section[i].cards.splice(c,1),s.save(),e.abrupt("return",s.section[i].cards);case 13:case"end":return e.stop()}}),e)}))),function(e,r,n){return m.apply(this,arguments)}),editCard:(v=h()(l.a.mark((function e(r,n,t){var a,o,s,i,c,u,p,d,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.section,o=n.card,s=n.input,i=s.color,c=s.title,u=s.description,e.next=4,B({req:t});case 4:if(p=e.sent,-1!==(d=p.section.findIndex((function(e){return e.title.toUpperCase()===a.toUpperCase()})))){e.next=8;break}throw new Error("No existe una sección con ese nombre");case 8:if(-1!==(f=p.section[d].cards.findIndex((function(e){return e.title.toUpperCase()===o.toUpperCase()})))){e.next=11;break}throw new Error("No existe una nota con ese nombre");case 11:return p.section[d].cards[f].title=c,p.section[d].cards[f].description=u,p.section[d].cards[f].color=i,p.save(),e.abrupt("return",p.section[d].cards);case 16:case"end":return e.stop()}}),e)}))),function(e,r,n){return v.apply(this,arguments)})}},D=n(10),Y=Object(D.makeExecutableSchema)({typeDefs:"\n    type AuthPayload {\n        user: User\n    }\n\n    type User {\n        name: String\n        email: String\n        section: [Section]\n    }\n\n    type Section{\n        color: String\n        icon: String\n        title: String\n        description: String\n        cards: [Card]\n    }\n\n    type Card{\n        color: String\n        title: String\n        description: String\n    }\n    \n    input UserInput {\n        name: String!\n        email: String!\n        password: String!\n    }\n\n    input SectionInput{\n        color: String!\n        icon: String!\n        title: String!\n        description: String!\n    }\n    \n    input CardInput{\n        color: String!\n        title: String!\n        description: String!\n    }\n\n    type Query {\n        currentUser: AuthPayload\n        getUserByCode(code: String!): AuthPayload\n        getCards(section: String!): [Card]\n    }\n\n    type Mutation {\n        checkCode(code: String!): Boolean\n        changePassword(oldPassword: String!, newPassword: String!): Boolean\n        login(username: String!, password: String!): AuthPayload\n        singup(input: UserInput): AuthPayload\n        logout: Boolean\n        newAccessToken(password:String!): Boolean\n        sendCodEmail(username:String!): Boolean\n        recoveryPassword(code:String!,newPassword: String!): Boolean\n        createSection(input: SectionInput!): AuthPayload\n        deleteSection(title: String!): AuthPayload\n        editSection(oldTitle: String!, input: SectionInput!): AuthPayload\n        createCard(section: String!, input: CardInput!): [Card]\n        deleteCard(section: String!, card: String!): [Card]\n        editCard(section: String!, card: String!, input: CardInput!): [Card]\n    }\n",resolvers:z}),F=n(11),G=n.n(F),Q=a()();Q.use("/",G()({schema:Y,graphiql:!0}));var $=Q,J=n(5),K=n.n(J);function V(){return(V=h()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K.a.connect(process.env.URL_DB,{useNewUrlParser:!0,useUnifiedTopology:!0,useFindAndModify:!1});case 3:console.log("DB connected"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var W=n(12),X=n.n(W),Z=n(13),ee=n.n(Z),re=a()();re.use(a.a.static(s.a.join(__dirname,"views"))),re.set("port",process.env.PORT),function(){V.apply(this,arguments)}(),re.use(ee()()),re.use(a.a.json()),re.use(X()()),re.use("/api",$),re.use("*",c),re.listen(re.get("port"),console.log("Server is running"))}]);